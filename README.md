# Курсовая работа
> [Задание](https://github.com/init/highload/blob/main/homework_architecture.md)

## 1. Тема и целевая аудитория
Amazon — американская компания, крупнейшая в мире на рынках платформ электронной коммерции и публично-облачных вычислений по выручке и рыночной капитализации.

### MVP
 - Регистрация пользователей (покупателей и продавцов), управление аккаунтом
 - Поиск и просмотр товаров в каталоге
 - Добавление товаров в корзину
 - Оформление заказа
 - Отзывы и рейтинти товаров
 - Создание товаров (для продавцов)
 - Управление заказами, осуществление их отправки, доставки, возвратов
 - Управление складом 

### Целевая аудитория [[1]](https://www.similarweb.com/ru/website/amazon.com/#traffic)
 - Общее количество визитов в месяц: 2.6 млрд (с настольных компьютеров и мобильных устройств)
 - Число уникальных пользователей в месяц (MAU) в США - 230 млн [[2]](https://www.statista.com/statistics/271412/most-visited-us-web-properties-based-on-number-of-visitors/)
     > Как я не искал, по всему миру этой статистики не нашел
 
**Распределение по странам:**
 1. США - 82.95%
 2. Канада - 1.09%
 3. Индия - 1.06%
 4. Великобритания - 0.97%
 5. Япония - 0.84%
 6. Другие страны - 13.10%

**Демография аудитории:**
 - Распределение по полу: 45.99% женщины и 54.01% мужчины
 - Самая многочисленная возрастная группа — 25-34 лет (29.18%)
    - 35-44: 19.24%
    - 18-24: 17.29%
    - 45-54: 15.21%
    - 55-64: 11.79%
    - 65+: 7.28%

## 2. Расчет нагрузки

### Продуктовые метрики
 - Месячная аудитория - 213 млн [[2]](https://www.statista.com/statistics/271412/most-visited-us-web-properties-based-on-number-of-visitors/)
 - Дневная аудитория - 28 млн [[3]](https://vc.ru/trade/594954-top-zarubezhnyh-marketpleysov-dlya-prodazhi-tovarov-v-2023-amazon-etsy-i-drugie)
 - Средний размер хранилища пользователя: ~1Мб
    > В хранилище пользователя входяд его заказы, личные и платежные данные, адреса и тп.
 - Среднее количество действий пользователя по типам в день:
    - Amazon имеет 9.5 млн продавцов (из них более 2.5 млн активных); каждый день к Amazon присоединяется более 2,000 новых продавцов [[4]](https://www.affiliatebay.net/ru/amazon-statistics/)
    - 66% пользователей сервиса для поиска товаров предпочитают Amazon, а не глобальный поиск [[5]](https://www.statista.com/statistics/235681/online-shoppers-digital-channels-of-choice-to-learn-about-products/)
    - ~40% пользователей совершают покупку 1-2 раза в месяц [[1]](https://www.similarweb.com/ru/website/amazon.com/#traffic)
    - Количество отправленных в день посылок: 1.6 млн [[6]](https://market.us/statistics/e-commerce-websites/amazon/)
    - 2-5% пользователей оставляют ревью после покупки товара [[7]](https://www.quora.com/What-percentage-of-buyers-write-reviews-on-Amazon)
    - Только Amazon продает более 12 миллионов товаров. Если принять во внимание сторонних продавцов, на Amazon Marketplace продается более 353 миллионов товаров. [[8]](https://0ca36445185fb449d582-f6ffa6baf5dd4144ff990b4132ba0c4d.ssl.cf1.rackcdn.com/IG_360piAmazon_9.13.16.pdf)

    **Итого:**

    | Действие        | Количество в день (на 1 пользователя) |
    | ------------- |:-------------:|
    | Регистрация  покупателей | 0.0008 |
    | Поиск      | 0.66      |
    | Добавление в корзину | 0.875  |
    | Оформление | 0.04      |
    | Добавление отзывов | 0.02  |
    | Создание товаров | 0.11     |
    | Отправка заказов | 0.05      |

### Технические метрики

#### Трафик

В месяц 2.6 млрд посещений, среднее количество страниц за визит - 10, средняя продолжительность визита 7 минут [[1]](https://www.similarweb.com/ru/website/amazon.com/#traffic)
> Из 2.6 млрд в месяц получаем примерно 1000 посещений в секунду (пусть будет 1500 RPS с учетом ретраев, ошибок и прочего)

Посчитаем количество товаров на каждой из основых страниц:

 1. Каталог: на странице находится 24 товара + в ленте рекомендаций еще 15 товаров (39 предпоказов)
 2. Поиск: на странице находится 12 товаров + в ленте рекомендаций еще 15 товаров (27 предпоказов)
 3. Сортировка: на странице находится 24 товара + в ленте рекомендаций еще 15 товаров (39 предпоказов)
 4. Страница товара: 1 товар + 20 товаров, которые предлагаются купить в комплекте + в ленте рекомендаций еще 15 товаров (1 полноценный товар и 35 предпоказов)

Предположим распределение запросов по действиям (выделим только основные):

| Действие        | Распределение | RPS |
| ------------- |:-------------:| :-------: |
| Каталог | 50%      | 750 |
| Поиск      | 25%      | 375 |
| Сортировка | 16%  | 240 |
| Страница товара | 9%     | 135 |

На предпоказ товара требуется:
 - Краткое описание + рейтинг ~1Кб
 - Сжатая картинка ~300Кб

Информация о товаре весит ~15Мб (картинки товара, его описание отзывы и прочее + возможно, мини-видео)

Получаем:

| Действие         | RPS | Трафик | 
| ------------- |:-------------:| :-------: |
| Каталог | 750 | 750 * 39 * 301Кб ~ 8.4Гб |
| Поиск        | 375 | 375 * 27 * 301Кб ~ 2.9Гб|
| Сортировка  | 240 | 240 * 39 * 301Кб ~ 2.7Гб|
| Страница товара    | 135 | 135 * (35 * 301Кб + 1 * 15Мб) ~ 3.3Гб|

**Итого** 
 - Трафик в секунду: 8.4 + 2.9 + 2.7 + 3.3 = **17.3 Гб/с** = **138.4 Гбит/с**
 - Трафик в сутки: 17.3 * 60 * 60 = **62280 Гб/сут**

**Пиковый**

Если трафик вырастет в 2 раза, то:
 - Трафик в секунду: **276.8 Гбит/с**
 - Трафик в сутки: **124560 Гб/сут**

#### RPS
 - Количество отправленных в день посылок: 1.6 млн, значит в секунду - 18. Столько же и оформлений заказов.
 - Каждый день к Amazon присоединяется более 2000 новых продавцов (всего продавцов 9.5 млн - это 10 процентов от общего числа пользователей), значит, новых пользователей каждый день примерно 20000 - в секунду ~6
 - 2-5% пользователей оставляют отзывы, в день 28 млн пользователей - 272 запроса в секунду
 - Предположим, что в корзине в среднем 2 товара, тогда количество запросов, чтобы положить товар в корзину в два раза больше, чем оформлений - 36 запросов в секунду
 - 66% людей пользуются поиском, в день 28 млн пользователей, предположим, что поиском пользуются в 1 из 10 случаев (в иных случаях пользуются категориями) - 513 запросов в секунду на поиск, 4500 запросов в секунду на просмотр каталога
 - Предположим, что покупатель в среднем покупает первый-второй товар, который отобразился в каталоге, тогда покупатель просматривает в 1.5 раза больше товаров, чем кладет в корзину - 54 запроса в секунду
 - Предположим, что 25% пользователей использует сортировку, тогда - 1283.3 запроса в секунду

Предположим, что в пике нагрузка вырастает в 2 раза.

**Итого**

| Действие        | Средний RPS | Пиковый RPS |
| ------------- |:-------------:|:-------------:|
| Оформление заказов      | 18   | 36 |
| Добавление в корзину | 36  | 72 |
| Добавление отзыва | 272   | 544 |
| Регистрация | 6  | 12 |
| Поиск | 513  | 1016 |
| Просмотр каталога | 4500  | 9000 |
| Просмотр товара | 54  | 108 |
| Сортировка | 1283.3  | 2566.6 |


## Источники
 1. https://www.similarweb.com/ru/website/amazon.com/#traffic
 2. https://www.statista.com/statistics/271412/most-visited-us-web-properties-based-on-number-of-visitors/
 3. https://vc.ru/trade/594954-top-zarubezhnyh-marketpleysov-dlya-prodazhi-tovarov-v-2023-amazon-etsy-i-drugie
 4. https://www.affiliatebay.net/ru/amazon-statistics/
 5. https://www.statista.com/statistics/235681/online-shoppers-digital-channels-of-choice-to-learn-about-products/
 6. https://market.us/statistics/e-commerce-websites/amazon/
 7. https://www.quora.com/What-percentage-of-buyers-write-reviews-on-Amazon
 8. https://0ca36445185fb449d582-f6ffa6baf5dd4144ff990b4132ba0c4d.ssl.cf1.rackcdn.com/IG_360piAmazon_9.13.16.pdf